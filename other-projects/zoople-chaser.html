<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
  <title>Zoople Chaser</title>
  <style>
    html, body { margin:0; padding:0; background:#000; width:100%; height:100%; overflow:hidden; display:flex; align-items:center; justify-content:center; }
    #gameContainer { position:relative; width:800px; height:600px; }
    #gameCanvas { position:absolute; top:0; left:0; width:800px; height:600px; background:#111; }
    .overlay { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; gap:20px; background:rgba(0,0,0,0.7); z-index:10; }
    #settings { display:none; }
    #pauseBtn { position:absolute; top:10px; right:10px; padding:4px 8px; font-size:14px; background:rgba(255,255,255,0.2); border:none; border-radius:4px; color:#fff; cursor:pointer; z-index:15; }
    button { padding:12px 24px; font-size:20px; background:rgba(255,255,255,0.1); color:#fff; border:2px solid #444; border-radius:6px; cursor:pointer; }
    button:hover { background:rgba(255,255,255,0.2); }
    .dropdown { position:relative; }
    .dropdown select { appearance:none; padding:10px 40px 10px 16px; font-size:18px; background:#444; color:#fff; border:2px solid #666; border-radius:6px; }
    .dropdown::after { content:'â–¾'; position:absolute; top:50%; right:12px; transform:translateY(-50%); color:#fff; }
    .toggle { position:relative; width:50px; height:24px; display:inline-block; }
    .toggle input { display:none; }
    .track { position:absolute; inset:0; background:#444; border-radius:12px; }
    .thumb { position:absolute; top:2px; left:2px; width:20px; height:20px; background:#fff; border-radius:50%; transition:transform .2s; }
    .toggle input:checked + .track { background:#4caf50; }
    .toggle input:checked + .track + .thumb { transform:translateX(26px); }
    #joystick { position:absolute; width:100px; height:100px; border:2px solid #fff; border-radius:50%; display:none; z-index:8; }
    #stick { position:absolute; width:40px; height:40px; background:rgba(255,255,255,0.5); border-radius:50%; left:30px; top:30px; }
  </style>
</head>
<body>
  <div id="gameContainer">
    <canvas id="gameCanvas" width="800" height="600"></canvas>
    <button id="pauseBtn">Pause</button>
    <div id="menu" class="overlay">
      <button id="playBtn">Play</button>
      <button id="settingsBtn">Settings</button>
      <button id="quitBtn">Quit</button>
    </div>
    <div id="settings" class="overlay">
      <h2 style="color:#fff;margin:0;">Settings</h2>
      <div style="color:#fff;display:flex;align-items:center;gap:10px;"><span>Physics Player</span><label class="toggle"><input type="checkbox" id="physPlayer"><div class="track"></div><div class="thumb"></div></label></div>
      <div style="color:#fff;display:flex;align-items:center;gap:10px;"><span>Physics Enemies</span><label class="toggle"><input type="checkbox" id="physEnemies"><div class="track"></div><div class="thumb"></div></label></div>
      <div style="color:#fff;display:flex;align-items:center;gap:10px;"><span>Difficulty</span><div class="dropdown"><select id="difficultySelect"><option value="Easy">Easy</option><option value="Hard">Hard</option></select></div></div>
      <div style="color:#fff;display:flex;align-items:center;gap:10px;"><span>Control Mode</span><div class="dropdown"><select id="controlModeSelect"><option value="touch">Follow Finger</option><option value="joystick">Dynamic Joystick</option></select></div></div>
      <button id="backBtn">Back</button>
    </div>
  </div>
  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const container = document.getElementById('gameContainer');
    function scale() { const s = Math.min(window.innerWidth/800, window.innerHeight/600); container.style.transform = `scale(${s})`; }
    window.addEventListener('resize', scale); scale();

    let physPlayer=false, physEnemies=true, difficulty='Hard', controlMode='touch';
    let running=false, paused=false;
    let pauseStart=0, pauseOffset=0, spawnPause=0;
    let level=1, levelDuration=10, levelStartTime=0;
    const player={x:400,y:300,r:15,velX:0,velY:0};
    let enemies = [];
    const ER=15;

    // UI bindings
    document.getElementById('physPlayer').checked=physPlayer;
    document.getElementById('physEnemies').checked=physEnemies;
    document.getElementById('difficultySelect').value=difficulty;
    document.getElementById('controlModeSelect').value=controlMode;
    document.getElementById('physPlayer').onchange=e=>physPlayer=e.target.checked;
    document.getElementById('physEnemies').onchange=e=>physEnemies=e.target.checked;
    document.getElementById('difficultySelect').onchange=e=>difficulty=e.target.value;
    document.getElementById('controlModeSelect').onchange=e=>controlMode=e.target.value;

    document.getElementById('playBtn').onclick = ()=> { startGame(); };
    document.getElementById('settingsBtn').onclick = ()=> { document.getElementById('settings').style.display='flex'; document.getElementById('menu').style.display='none'; };
    document.getElementById('backBtn').onclick = ()=> { document.getElementById('settings').style.display='none'; document.getElementById('menu').style.display='flex'; };
    document.getElementById('quitBtn').onclick = ()=> location='https://dipilo.github.io/other-projects';

    // Pause
    document.getElementById('pauseBtn').onclick = ()=>{
      if(running){ paused=!paused; document.getElementById('menu').style.display = paused?'flex':'none'; if(paused) pauseStart=performance.now(); else pauseOffset += performance.now()-pauseStart; }
    };
    window.addEventListener('keydown', e => { if(e.key==='Escape') document.getElementById('pauseBtn').onclick(); });

    // Physics parameters
    const MAX_P=400, MAX_E=250;
    const STEER_P=20000, STEER_E=15000;
    const DAMP=0.7, ICONE=Math.cos(Math.PI/6);
    const SEP_R=40, SEP_F=20000;

    // Input
    const keys={}; window.addEventListener('keydown',e=>keys[e.key.toLowerCase()]=true);
    window.addEventListener('keyup',e=>keys[e.key.toLowerCase()]=false);
    let mx=0,my=0,md=false;
    canvas.addEventListener('mousedown',e=>{md=true;updateMouse(e);} ); window.addEventListener('mouseup',()=>md=false);
    canvas.addEventListener('mousemove',updateMouse);
    function updateMouse(e){ const r=canvas.getBoundingClientRect(); mx=(e.clientX-r.left)*800/r.width; my=(e.clientY-r.top)*600/r.height; }

    // Touch
    let touchActive=false, tx=0, ty=0;
    const joy = document.getElementById('joystick');
    const stick = document.getElementById('stick');
    let jcX=0, jcY=0;
    canvas.addEventListener('touchstart',e=>{
      const t=e.touches[0],r=canvas.getBoundingClientRect(); touchActive=true;
      tx=(t.clientX-r.left)*800/r.width; ty=(t.clientY-r.top)*600/r.height;
      if(controlMode==='joystick'){
        jcX=tx; jcY=ty;
        joy.style.left=`${t.clientX-50}px`; joy.style.top=`${t.clientY-50}px`; joy.style.display='block';
      }
    });
    canvas.addEventListener('touchmove',e=>{
      const t=e.touches[0],r=canvas.getBoundingClientRect();
      tx=(t.clientX-r.left)*800/r.width; ty=(t.clientY-r.top)*600/r.height;
      if(controlMode==='joystick'){
        const dx=tx-jcX, dy=ty-jcY, d=Math.hypot(dx,dy);
        const ux=d?dx/d:0, uy=d?dy/d:0;
        const len=Math.min(d,50);
        stick.style.left=`${50+ux*len-20}px`;
        stick.style.top =`${50+uy*len-20}px`;
      }
    });
    canvas.addEventListener('touchend',()=>{ touchActive=false; joy.style.display='none'; });

    function clamp(o){ o.x=Math.max(o.r,Math.min(800-o.r,o.x)); o.y=Math.max(o.r,Math.min(600-o.r,o.y)); }
    function separate(arr,ds){ arr.forEach((a,i)=>arr.forEach((b,j)=>{ if(i!==j){ const dx=a.x-b.x, dy=a.y-b.y, d=Math.hypot(dx,dy); if(d<SEP_R&&d>0){ const f=(SEP_R-d)/d*SEP_F*ds; a.velX+=dx/d*f; a.velY+=dy/d*f; } }})); }

    function spawnEnemy(at){ spawnPause=0.2; enemies.forEach(e=>{e.velX=0; e.velY=0;});
      let x,y; do{x=Math.random()*(800-2*ER)+ER; y=Math.random()*(600-2*ER)+ER;}while(Math.hypot(x-player.x,y-player.y)<player.r*4);
      if(at){ x=at[0]+(Math.random()*200-100); y=at[1]+(Math.random()*200-100);
        x=Math.max(ER,Math.min(800-ER,x)); y=Math.max(ER,Math.min(600-ER,y)); }
      enemies.push({x,y,velX:0,velY:0,intercept:Math.random()<0.5});
    }

    function resetGame(){ running=false; enemies.length=0; player.x=400; player.y=300; player.velX=player.velY=0; level=1; pauseOffset=0; document.getElementById('menu').style.display='flex'; }
    function startGame(){ resetGame(); spawnEnemy(); levelStartTime=performance.now(); running=true; paused=false; document.getElementById('menu').style.display='none'; }

    function update(dt){ if(!running||paused) return; const ds=dt/1000; let ax=0, ay=0;
      // input handling
      if(controlMode==='joystick'&&touchActive){ const dx=(tx-jcX)/50, dy=(ty-jcY)/50, mag=Math.hypot(dx,dy); ax=mag>1?dx/mag:dx; ay=mag>1?dy/mag:dy; }
      else if(controlMode==='touch'&&touchActive){ const dx=tx-player.x, dy=ty-player.y, d=Math.hypot(dx,dy); if(d>0){ax=dx/d; ay=dy/d;}} 
      else { if(keys['w']) ay--; if(keys['s']) ay++; if(keys['a']) ax--; if(keys['d']) ax++; if(md){ const dx=mx-player.x, dy=my-player.y, d=Math.hypot(dx,dy); if(d>0){ ax=dx/d; ay=dy/d; } }}
      // apply physics
      if(physPlayer){ const dvx=ax*MAX_P-player.velX, dvy=ay*MAX_P-player.velY, dvm=Math.hypot(dvx,dvy), maxF=STEER_P*ds; const sx=dvm>maxF?dvx/dvm*maxF:dvx, sy=dvm>maxF?dvy/dvm*maxF:dvy; player.velX+=sx; player.velY+=sy; player.velX*=DAMP; player.velY*=DAMP; player.x+=player.velX*ds; player.y+=player.velY*ds; } 
      else { player.x+=ax*MAX_P*ds; player.y+=ay*MAX_P*ds; } clamp(player);
      // spawn pause
      if(spawnPause>0) spawnPause-=ds; else {
        enemies.forEach(e=>{
          let txp=player.x, typ=player.y;
          if(difficulty==='Hard' && e.intercept){ const lt=0.5, ix=player.x+player.velX*lt, iy=player.y+player.velY*lt, distD=Math.hypot(player.x-e.x,player.y-e.y), distI=Math.hypot(ix-e.x,iy-e.y), ux_e=distD?(player.x-e.x)/distD:0, uy_e=distD?(player.y-e.y)/distD:0, pv=Math.hypot(player.velX,player.velY), upx=pv?player.velX/pv:0, upy=pv?player.velY/pv:0, dot=ux_e*upx+uy_e*upy; if(!(distD<distI||dot>INTERCEPT_CONE)){ txp=(player.x+ix)/2; typ=(player.y+iy)/2; } }
          const dx=txp-e.x, dy=typ-e.y, d2=Math.hypot(dx,dy), ux2=d2?dx/d2:0, uy2=d2?dy/d2:0;
          if(physEnemies){ const dvx=ux2*MAX_E-e.velX, dvy=uy2*MAX_E-e.velY, dvm2=Math.hypot(dvx,dvy), maxF2=STEER_E*ds; const sx2=dvm2>maxF2?dvx/dvm2*maxF2:dvx, sy2=dvm2>maxF2?dvy/dvm2*maxF2:dvy; e.velX+=sx2; e.velY+=sy2; e.velX*=DAMP; e.velY*=DAMP; e.x+=e.velX*ds; e.y+=e.velY*ds; }
          else { e.x+=ux2*MAX_E*ds; e.y+=uy2*MAX_E*ds; } clamp(e);
        }); separate(enemies, ds);
      }
      // collision
      if(enemies.some(e=>Math.hypot(player.x-e.x,player.y-e.y)<player.r+ER)) resetGame();
      // level
      const elapsed=(performance.now()-pauseOffset-levelStartTime)/1000;
      if(elapsed>=levelDuration){ const avgX=enemies.reduce((s,e)=>s+e.x,0)/enemies.length, avgY=enemies.reduce((s,e)=>s+e.y,0)/enemies.length; level++; enemies.forEach(e=>e.intercept=Math.random()<0.5); spawnEnemy([avgX,avgY]); levelStartTime=performance.now()-pauseOffset; }
    }

    function draw(){ ctx.clearRect(0,0,800,600); ctx.fillStyle='#222'; ctx.font='200px sans-serif'; ctx.textAlign='center'; ctx.textBaseline='middle'; const elapsed=(running?(performance.now()-pauseOffset-levelStartTime)/1000:0), rem=Math.max(0, levelDuration-Math.floor(elapsed)); ctx.fillText(rem,400,300); ctx.fillStyle='#fff'; ctx.font='36px sans-serif'; ctx.textBaseline='top'; ctx.fillText(`Level: ${level}`,400,10); ctx.drawImage(playerImg,player.x-player.r,player.y-player.r,player.r*2,player.r*2); enemies.forEach(e=>ctx.drawImage(enemyImg,e.x-ER,e.y-ER,ER*2,ER*2)); }

    let last=performance.now(); (function loop(){ const now=performance.now(), dt=now-last; update(dt); draw(); last=now; requestAnimationFrame(loop); })();
  </script>
</body>
</html>
